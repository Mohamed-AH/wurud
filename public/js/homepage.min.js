!function(){"use strict";const e={tab:"series",page:1,limit:10,category:"all",type:"all",search:"",sort:"newest",loading:!1,hasMore:{series:!0,standalone:!0,khutbas:!0}},t={Tafsir:"ØªÙØ³ÙŠØ±",Hadith:"Ø­Ø¯ÙŠØ«",Fiqh:"ÙÙ‚Ù‡",Aqeedah:"Ø¹Ù‚ÙŠØ¯Ø©",Seerah:"Ø³ÙŠØ±Ø©",Akhlaq:"Ø£Ø®Ù„Ø§Ù‚",Other:"Ø£Ø®Ø±Ù‰"};let n,a,s,i,o;function r(){n=document.querySelector("#content-series .series-list"),a=document.querySelector("#content-lectures .series-list"),s=document.querySelector("#content-khutbas .series-list"),i=document.createElement("button"),i.className="load-more-btn",i.innerHTML="ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯",i.style.cssText="\n      display: none;\n      width: 100%;\n      max-width: 300px;\n      margin: 24px auto;\n      padding: 12px 24px;\n      background: var(--color-gold, #C19A6B);\n      color: white;\n      border: none;\n      border-radius: 8px;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: background 0.2s;\n    ",i.addEventListener("click",f),function(){o=document.createElement("div"),o.className="loading-indicator",o.innerHTML='\n      <div style="display: flex; align-items: center; justify-content: center; gap: 8px; padding: 24px; color: #666;">\n        <svg width="24" height="24" viewBox="0 0 24 24" class="spin">\n          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/>\n          <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" stroke-width="2" fill="none"/>\n        </svg>\n        <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>\n      </div>\n    ',o.style.display="none";const e=document.createElement("style");e.textContent="\n      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }\n      .spin { animation: spin 1s linear infinite; }\n      .load-more-btn:hover { background: var(--color-gold-dark, #A67C52); }\n    ",document.head.appendChild(e)}(),function(){const t=new URLSearchParams(window.location.search);t.has("tab")&&(e.tab=t.get("tab"));t.has("category")&&(e.category=t.get("category"));t.has("type")&&(e.type=t.get("type"));t.has("search")&&(e.search=t.get("search"));t.has("sort")&&(e.sort=t.get("sort"))}(),function(){document.querySelectorAll(".nav-tab").forEach(e=>{e.addEventListener("click",function(){u(this.id.replace("tab-",""))})}),document.querySelectorAll('.chip[data-type="category"]').forEach(e=>{e.addEventListener("click",function(){h("category",this.dataset.filter)})}),document.querySelectorAll('.chip[data-type="seriesType"]').forEach(e=>{e.addEventListener("click",function(){h("type",this.dataset.filter)})}),document.querySelectorAll(".chip[data-sort]").forEach(e=>{e.addEventListener("click",function(){y(this.dataset.sort)})});const t=document.getElementById("searchInput");if(t){let n;t.addEventListener("input",function(){clearTimeout(n),n=setTimeout(()=>{var t;t=this.value,e.search=t.trim(),e.page=1,c(),m(),b(!0)},300)})}const n=document.getElementById("clearFiltersBtn");n&&n.addEventListener("click",g)}(),d(),function(){const t=p();if(t){(0===t.querySelectorAll(".series-card").length||"all"!==e.category||"all"!==e.type||e.search)&&(e.page=1,b(!0))}}()}function c(){const t=new URLSearchParams;"series"!==e.tab&&t.set("tab",e.tab),"all"!==e.category&&t.set("category",e.category),"all"!==e.type&&t.set("type",e.type),e.search&&t.set("search",e.search),"newest"!==e.sort&&t.set("sort",e.sort);const n=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",n)}function d(){document.querySelectorAll(".nav-tab").forEach(e=>e.classList.remove("active"));const t=document.getElementById("tab-"+e.tab);t&&t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active"));const n=document.getElementById("content-"+e.tab);n&&n.classList.add("active"),document.querySelectorAll('.chip[data-type="category"]').forEach(t=>{t.classList.toggle("active",t.dataset.filter===e.category)}),document.querySelectorAll('.chip[data-type="seriesType"]').forEach(t=>{t.classList.toggle("active",t.dataset.filter===e.type)}),document.querySelectorAll(".chip[data-sort]").forEach(t=>{t.classList.toggle("active",t.dataset.sort===e.sort)});const a=document.getElementById("searchInput");a&&e.search&&(a.value=e.search),m(),l()}function l(){let t;if("series"===e.tab?t=n:"lectures"===e.tab?t=a:"khutbas"===e.tab&&(t=s),t){i.parentNode&&i.parentNode.removeChild(i),o.parentNode&&o.parentNode.removeChild(o),t.parentNode.appendChild(o),t.parentNode.appendChild(i);const n="lectures"===e.tab?"standalone":e.tab;i.style.display=e.hasMore[n]?"block":"none"}}function p(){return"series"===e.tab?n:"lectures"===e.tab?a:"khutbas"===e.tab?s:null}function u(t){e.tab=t,e.page=1,d(),c();const n=p();0===(n?n.querySelectorAll(".series-card"):[]).length||"all"!==e.category||"all"!==e.type||e.search?b(!0):function(){const t=p();if(!t)return;const n=t.querySelectorAll(".series-card");n.forEach(t=>{const n=t.dataset.category,a=t.dataset.seriesType,s="all"===e.category||n===e.category,i="all"===e.type||a===e.type;t.style.display=s&&i?"block":"none"}),function(t){const n=Array.from(t.querySelectorAll(".series-card"));n.sort((t,n)=>{const a=parseInt(t.dataset.date)||0,s=parseInt(n.dataset.date)||0;return"newest"===e.sort?s-a:a-s}),n.forEach(e=>t.appendChild(e))}(t)}()}function h(t,n){"category"===t?e.category=n:"type"===t&&(e.type=n),e.page=1,d(),c(),b(!0)}function y(t){e.sort=t,e.page=1,d(),c(),b(!0)}function g(){e.category="all",e.type="all",e.search="",e.sort="newest",e.page=1;const t=document.getElementById("searchInput");t&&(t.value=""),d(),c(),b(!0)}function m(){const t=document.getElementById("clearFiltersBtn");if(!t)return;const n="all"!==e.category||"all"!==e.type||"newest"!==e.sort||""!==e.search;t.style.display=n?"inline-block":"none"}function f(){e.page++,b(!1)}async function b(t=!0){if(!e.loading){e.loading=!0,o.style.display="block",i.style.display="none";try{let i;const o=new URLSearchParams;o.set("page",e.page),o.set("sort",e.sort),"all"!==e.category&&o.set("category",e.category),e.search&&o.set("search",e.search),"series"===e.tab?(i="/api/homepage/series",o.set("limit","10"),"all"!==e.type&&o.set("type",e.type)):"lectures"===e.tab?(i="/api/homepage/standalone",o.set("limit","20")):"khutbas"===e.tab&&(i="/api/homepage/khutbas",o.set("limit","10"));const r=await fetch(`${i}?${o.toString()}`),c=await r.json();if(c.success){if("lectures"===e.tab)!function(e,t){if(!a)return;t&&(a.innerHTML="");if(0===e.length&&t)return void(a.innerHTML=$("Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª"));e.forEach(e=>{const t=function(e){const t=document.createElement("div");t.className="series-card";const n=e.dateRecorded?new Date(e.dateRecorded).getTime():e.createdAt?new Date(e.createdAt).getTime():Date.now();t.dataset.date=n,t.dataset.hijri=e.dateRecordedHijri||"";const a=e.sheikhId?.nameArabic||"",s=e.duration&&e.duration>0?`â±ï¸ ${Math.floor(e.duration/60)}:${String(e.duration%60).padStart(2,"0")}`:"",i=e.dateRecordedHijri?`ğŸ“… ${w(e.dateRecordedHijri)}`:"",o=k(e.titleArabic||"").replace(/'/g,"\\'"),r=k(a).replace(/'/g,"\\'");return t.innerHTML=`\n      <div class="series-header">\n        <h2 class="series-title">${k(e.titleArabic||"")}</h2>\n        <div class="series-meta">\n          <div class="series-sheikh">\n            Ø§Ù„Ø´ÙŠØ®: ${k(a)}\n          </div>\n        </div>\n        <div class="series-info">\n          ${s?`<span>${s}</span>`:""}\n          ${i?`<span class="hijri-date">${i}</span>`:""}\n        </div>\n        <div class="episode-actions" style="margin-top: 16px;">\n          ${e.audioFileName||e.audioUrl?`\n            <button class="btn-play" onclick="playAudio('${e._id}', '${o}', '${r}')">\n              â–¶ ØªØ´ØºÙŠÙ„\n            </button>\n            <a href="/download/${e._id}" class="btn-download">\n              â¬‡ ØªØ­Ù…ÙŠÙ„\n            </a>\n          `:""}\n        </div>\n      </div>\n    `,t}(e);a.appendChild(t)})}(c.lectures,t),e.hasMore.standalone=c.pagination.hasMore;else{const a=c.series||[];"series"===e.tab?(!function(e,t){if(!n)return;t&&(n.innerHTML="");if(0===e.length&&t)return void(n.innerHTML=$("Ø§Ù„Ø³Ù„Ø§Ø³Ù„"));e.forEach(e=>{const t=v(e,!1);n.appendChild(t)})}(a,t),e.hasMore.series=c.pagination.hasMore):"khutbas"===e.tab&&(!function(e,t){if(!s)return;t&&(s.innerHTML="");if(0===e.length&&t)return void(s.innerHTML=$("Ø§Ù„Ø®Ø·Ø¨"));e.forEach(e=>{const t=v(e,!0);s.appendChild(t)})}(a,t),e.hasMore.khutbas=c.pagination.hasMore)}l()}}catch(e){console.error("Error fetching data:",e)}finally{e.loading=!1,o.style.display="none"}}}function v(e,n=!1){const a=document.createElement("div");a.className="series-card",a.dataset.category=e.category||"Other",a.dataset.date=e.mostRecentDate?new Date(e.mostRecentDate).getTime():0,a.dataset.seriesType=e.seriesType||"masjid";const s=n?"khutba-":"",i=n?`khutba-episodes-${e._id}`:`episodes-${e._id}`,o=n?`khutba-btn-${e._id}`:`btn-${e._id}`,r=n?"toggleKhutba":"toggleSeries",c=n?"Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø¨ â–¼":"Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³ â–¼",d=e.sheikh?.nameArabic||"",l=t[e.category]||e.category||"Ø£Ø®Ø±Ù‰";return a.innerHTML=`\n      <div class="series-header" onclick="${r}('${e._id}')">\n        <h2 class="series-title">${k(e.titleArabic||"")}</h2>\n\n        <div class="series-meta">\n          ${e.originalAuthor?`\n            <div class="series-author">\n              <span class="series-author-label">Ø§Ù„Ù…Ø¤Ù„Ù:</span>\n              ${k(e.originalAuthor)}\n            </div>\n          `:""}\n          <div class="series-sheikh">\n            Ø§Ù„Ø´ÙŠØ®: ${k(d)}\n          </div>\n        </div>\n\n        <div class="series-info">\n          <span>${e.lectureCount||0} Ø¯Ø±Ø³</span>\n          <span class="category-badge">${l}</span>\n        </div>\n\n        <button class="expand-btn" id="${o}">\n          ${c}\n        </button>\n      </div>\n\n      <div class="episodes-list" id="${i}">\n        <div style="padding: 12px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; display: flex; gap: 8px; align-items: center;">\n          <span style="font-size: 13px; font-weight: 600; color: #666;">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¯Ø±ÙˆØ³:</span>\n          <button class="chip" onclick="sortSeriesLectures('${s}${e._id}', 'number'); event.stopPropagation();" style="padding: 4px 12px; font-size: 12px;">\n            Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…\n          </button>\n          <button class="chip" onclick="sortSeriesLectures('${s}${e._id}', 'oldest'); event.stopPropagation();" style="padding: 4px 12px; font-size: 12px;">\n            Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹\n          </button>\n          <button class="chip" onclick="sortSeriesLectures('${s}${e._id}', 'newest'); event.stopPropagation();" style="padding: 4px 12px; font-size: 12px;">\n            Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹\n          </button>\n        </div>\n        <div class="episodes-container">\n          ${(e.lectures||[]).map((e,t)=>function(e,t,n){const a=e.duration&&e.duration>0?`â±ï¸ ${Math.floor(e.duration/60)}:${String(e.duration%60).padStart(2,"0")}`:"",s=e.dateRecordedHijri?`ğŸ“… ${w(e.dateRecordedHijri)}`:"",i=e.dateRecorded?new Date(e.dateRecorded).getTime():0,o=k(e.titleArabic||"").replace(/'/g,"\\'"),r=k(n).replace(/'/g,"\\'");return`\n      <div class="episode-item" data-lecture-number="${t+1}" data-date="${i}">\n        <div class="episode-header">\n          <div class="episode-number">${t+1}</div>\n          <div class="episode-title">${k(e.titleArabic||"")}</div>\n        </div>\n        <div class="episode-meta">\n          ${a?`<span>${a}</span>`:""}\n          ${e.location?`<span>${k(e.location)}</span>`:""}\n          ${s?`<span class="hijri-date">${s}</span>`:""}\n        </div>\n        <div class="episode-actions">\n          <button class="btn-play" onclick="playAudio('${e._id}', '${o}', '${r}')">\n            â–¶ ØªØ´ØºÙŠÙ„\n          </button>\n          <a href="/download/${e._id}" class="btn-download">\n            â¬‡ ØªØ­Ù…ÙŠÙ„\n          </a>\n        </div>\n      </div>\n    `}(e,t,d)).join("")}\n        </div>\n      </div>\n    `,a}function $(e){return`\n      <div class="empty-state">\n        <div class="empty-icon">ğŸ“š</div>\n        <h3 class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ ${e}</h3>\n        <p class="empty-text">Ø¬Ø±Ø¨ Ø¨Ø­Ø«Ø§Ù‹ Ø¢Ø®Ø±</p>\n      </div>\n    `}function w(e){if(!e)return"";const t=["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"];return e.replace(/[0-9]/g,e=>t[parseInt(e)])}function k(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}window.switchTab=u,window.filterBySeriesType=e=>h("type",e),window.sortByDate=y,window.clearAllFilters=g,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",r):r()}();