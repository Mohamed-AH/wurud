<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - Duroos</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    .header {
      background: #1A5F5A;
      color: white;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .header h1 { font-size: 24px; font-weight: 600; }
    .header-nav { display: flex; align-items: center; gap: 16px; }
    .header-nav a { color: white; text-decoration: none; opacity: 0.9; }
    .header-nav a:hover { opacity: 1; }
    .container { max-width: 800px; margin: 0 auto; padding: 32px 24px; }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 32px;
    }
    .form-group {
      margin-bottom: 24px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2C3E35;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-left: 8px;
    }
    .btn-primary {
      background: #1A5F5A;
      color: white;
    }
    .btn-primary:hover {
      background: #145047;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    .actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }
    .lectures-section {
      margin-top: 48px;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #1A5F5A;
    }
    .lecture-count {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 14px;
    }
    .lectures-list {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .lecture-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      background: white;
      transition: background 0.2s;
    }
    .lecture-item:last-child {
      border-bottom: none;
    }
    .lecture-item:hover {
      background: #f8f9fa;
    }
    .lecture-item.dragging {
      opacity: 0.5;
      background: #e3f2fd;
    }
    .lecture-item.drag-over {
      border-top: 3px solid #1A5F5A;
    }
    .drag-handle {
      cursor: grab;
      color: #999;
      font-size: 18px;
      padding: 4px;
    }
    .drag-handle:active {
      cursor: grabbing;
    }
    .lecture-order {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #1A5F5A;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      flex-shrink: 0;
    }
    .lecture-info {
      flex: 1;
      min-width: 0;
    }
    .lecture-title {
      font-weight: 500;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .lecture-meta {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    .lecture-actions {
      display: flex;
      gap: 4px;
    }
    .move-btn {
      width: 28px;
      height: 28px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s;
    }
    .move-btn:hover {
      background: #1A5F5A;
      color: white;
      border-color: #1A5F5A;
    }
    .move-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .action-btn {
      width: 28px;
      height: 28px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.2s;
      text-decoration: none;
    }
    .edit-btn:hover {
      background: #1A5F5A;
      border-color: #1A5F5A;
    }
    .remove-btn {
      color: #dc3545;
      font-weight: bold;
    }
    .remove-btn:hover {
      background: #dc3545;
      color: white;
      border-color: #dc3545;
    }
    .save-order-btn {
      margin-top: 16px;
      padding: 12px 24px;
      background: #1A5F5A;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: none;
    }
    .save-order-btn:hover {
      background: #145047;
    }
    .save-order-btn.visible {
      display: inline-block;
    }
    .status-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      margin-right: 8px;
    }
    .status-published {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .status-draft {
      background: #fff3e0;
      color: #e65100;
    }
    .empty-lectures {
      padding: 32px;
      text-align: center;
      color: #666;
    }
    .btn-add-lecture {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      background: #D4AF37;
      color: #2C1810;
      text-decoration: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-add-lecture:hover {
      background: #c9a033;
      transform: translateY(-1px);
    }
    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #c3e6cb;
    }
    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù„Ø³Ù„Ø©</h1>
    <div class="header-nav">
      <a href="/admin/dashboard">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
      <a href="/admin/manage">Ø¥Ø¯Ø§Ø±Ø©</a>
      <a href="/auth/logout">Ø®Ø±ÙˆØ¬</a>
    </div>
  </div>

  <div class="container">
    <% if (typeof success !== 'undefined' && success === 'lecture_added') { %>
      <div class="success-message">âœ“ ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³ Ø¨Ù†Ø¬Ø§Ø­</div>
    <% } %>
    <% if (typeof success !== 'undefined' && success === 'updated') { %>
      <div class="success-message">âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</div>
    <% } %>
    <% if (typeof error !== 'undefined' && error === 'add_failed') { %>
      <div class="error-message">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø±Ø³</div>
    <% } %>
    <div class="card">
      <form method="POST" action="/admin/series/<%= series._id %>/edit">
        <div class="form-group">
          <label for="titleArabic">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© *</label>
          <input
            type="text"
            id="titleArabic"
            name="titleArabic"
            value="<%= series.titleArabic %>"
            required
          >
        </div>

        <div class="form-group">
          <label for="titleEnglish">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
          <input
            type="text"
            id="titleEnglish"
            name="titleEnglish"
            value="<%= series.titleEnglish || '' %>"
          >
        </div>

        <div class="form-group">
          <label for="category">Ø§Ù„ØªØµÙ†ÙŠÙ (ÙŠØªØ­ÙƒÙ… Ø¨ÙÙ„ØªØ± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)</label>
          <%
            // Default to 'Other' if category is null/undefined
            const currentCategory = series.category || 'Other';
          %>
          <select id="category" name="category" style="background: #fffbf0; border: 2px solid #C19A6B;">
            <option value="Aqeedah" <%= currentCategory === 'Aqeedah' ? 'selected' : '' %>>Ø¹Ù‚ÙŠØ¯Ø©</option>
            <option value="Fiqh" <%= currentCategory === 'Fiqh' ? 'selected' : '' %>>ÙÙ‚Ù‡</option>
            <option value="Tafsir" <%= currentCategory === 'Tafsir' ? 'selected' : '' %>>ØªÙØ³ÙŠØ±</option>
            <option value="Hadith" <%= currentCategory === 'Hadith' ? 'selected' : '' %>>Ø­Ø¯ÙŠØ«</option>
            <option value="Seerah" <%= currentCategory === 'Seerah' ? 'selected' : '' %>>Ø³ÙŠØ±Ø©</option>
            <option value="Akhlaq" <%= currentCategory === 'Akhlaq' ? 'selected' : '' %>>Ø£Ø®Ù„Ø§Ù‚</option>
            <option value="Other" <%= currentCategory === 'Other' ? 'selected' : '' %>>Ø£Ø®Ø±Ù‰</option>
          </select>
          <p style="font-size: 12px; color: #C19A6B; margin-top: 4px; font-weight: 600;">
            âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ÙŠØ­Ø¯Ø¯ ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ù„Ø³Ù„Ø© ÙÙŠ ÙÙ„Ø§ØªØ± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </p>
        </div>

        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
          <div style="display: flex; gap: 24px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
            <%
              // Content TYPE tags only - subject/topic is handled by Category above
              const availableTags = ['series', 'lecture', 'khutba'];
              const tagLabels = {
                'series': 'Ø³Ù„Ø³Ù„Ø© Ø¯Ø±ÙˆØ³',
                'lecture': 'Ù…Ø­Ø§Ø¶Ø±Ø© Ù…Ù†ÙØ±Ø¯Ø©',
                'khutba': 'Ø®Ø·Ø¨Ø© Ø¬Ù…Ø¹Ø©'
              };
              const seriesTags = series.tags || [];
            %>
            <% availableTags.forEach(tag => { %>
              <div class="checkbox-group">
                <input
                  type="checkbox"
                  id="tag-<%= tag %>"
                  name="tags"
                  value="<%= tag %>"
                  <%= seriesTags.includes(tag) ? 'checked' : '' %>
                >
                <label for="tag-<%= tag %>" style="margin-bottom: 0; margin-right: 8px;"><%= tagLabels[tag] %></label>
              </div>
            <% }) %>
          </div>
          <p style="font-size: 12px; color: #666; margin-top: 8px;">
            ğŸ’¡ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙŠØ­Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: Ø¹Ù‚ÙŠØ¯Ø©ØŒ ÙÙ‚Ù‡ØŒ Ø¥Ù„Ø®)
          </p>
        </div>

        <div class="form-group">
          <label for="descriptionArabic">Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label>
          <textarea
            id="descriptionArabic"
            name="descriptionArabic"
          ><%= series.descriptionArabic || '' %></textarea>
        </div>

        <div class="form-group">
          <label for="descriptionEnglish">Ø§Ù„ÙˆØµÙ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label>
          <textarea
            id="descriptionEnglish"
            name="descriptionEnglish"
          ><%= series.descriptionEnglish || '' %></textarea>
        </div>

        <div class="form-group">
          <label for="bookAuthor">Ø§Ù„Ù…Ø¤Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„ÙƒØªØ§Ø¨</label>
          <input
            type="text"
            id="bookAuthor"
            name="bookAuthor"
            value="<%= series.bookAuthor || '' %>"
            placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø´ÙŠØ® Ø£Ø­Ù…Ø¯ Ø¨Ù† ÙŠØ­ÙŠÙ‰ Ø§Ù„Ù†Ø¬Ù…ÙŠ"
          >
          <p style="font-size: 12px; color: #666; margin-top: 4px;">
            ğŸ’¡ Ø§Ø³Ù… Ù…Ø¤Ù„Ù Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ø°ÙŠ ÙŠØ´Ø±Ø­Ù‡ Ø§Ù„Ø´ÙŠØ® (ÙŠØ¸Ù‡Ø± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø³Ù„Ø©)
          </p>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
          <a href="/admin/manage" class="btn btn-secondary">â†©ï¸ Ø¥Ù„ØºØ§Ø¡</a>
        </div>
      </form>

      <!-- Lectures Reorder Section -->
      <div class="lectures-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ“š ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
          <div style="display: flex; align-items: center; gap: 12px;">
            <span class="lecture-count"><%= lectures.length %> Ù…Ø­Ø§Ø¶Ø±Ø©</span>
            <a href="/admin/series/<%= series._id %>/quick-add-lecture" class="btn-add-lecture" title="Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯">
              + Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³
            </a>
          </div>
        </div>

        <% if (lectures && lectures.length > 0) { %>
          <div class="lectures-list" id="lecturesList">
            <% lectures.forEach((lecture, index) => { %>
              <div class="lecture-item" data-id="<%= lecture._id %>" draggable="true">
                <span class="drag-handle">â‹®â‹®</span>
                <div class="lecture-order"><%= index + 1 %></div>
                <div class="lecture-info">
                  <div class="lecture-title">
                    <span class="status-badge <%= lecture.published ? 'status-published' : 'status-draft' %>">
                      <%= lecture.published ? 'Ù…Ù†Ø´ÙˆØ±' : 'Ù…Ø³ÙˆØ¯Ø©' %>
                    </span>
                    <%= lecture.titleArabic %>
                  </div>
                  <div class="lecture-meta">
                    <% if (lecture.lectureNumber) { %>
                      Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø³: <%= lecture.lectureNumber %> |
                    <% } %>
                    <% if (lecture.dateRecorded) { %>
                      Ø§Ù„ØªØ§Ø±ÙŠØ®: <%= new Date(lecture.dateRecorded).toLocaleDateString('ar-SA') %>
                    <% } %>
                  </div>
                </div>
                <div class="lecture-actions">
                  <a href="/admin/lectures/<%= lecture._id %>/edit" class="action-btn edit-btn" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</a>
                  <button class="action-btn remove-btn" onclick="removeLectureFromSeries('<%= lecture._id %>', '<%= lecture.titleArabic.substring(0, 30) %>')" title="Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø³Ù„Ø³Ù„Ø©">âœ•</button>
                  <button class="move-btn" onclick="moveLecture('<%= lecture._id %>', 'up')" title="ØªØ­Ø±ÙŠÙƒ Ù„Ø£Ø¹Ù„Ù‰" <%= index === 0 ? 'disabled' : '' %>>â–²</button>
                  <button class="move-btn" onclick="moveLecture('<%= lecture._id %>', 'down')" title="ØªØ­Ø±ÙŠÙƒ Ù„Ø£Ø³ÙÙ„" <%= index === lectures.length - 1 ? 'disabled' : '' %>>â–¼</button>
                </div>
              </div>
            <% }); %>
          </div>

          <button class="save-order-btn" id="saveOrderBtn" onclick="saveOrder()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯</button>
        <% } else { %>
          <div class="lectures-list">
            <div class="empty-lectures">
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù„Ø³Ù„Ø©</p>
            </div>
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <script>
    const seriesId = '<%= series._id %>';
    let orderChanged = false;

    // Drag and drop functionality
    const lecturesList = document.getElementById('lecturesList');
    if (lecturesList) {
      let draggedItem = null;

      lecturesList.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('lecture-item')) {
          draggedItem = e.target;
          e.target.classList.add('dragging');
        }
      });

      lecturesList.addEventListener('dragend', (e) => {
        if (e.target.classList.contains('lecture-item')) {
          e.target.classList.remove('dragging');
          document.querySelectorAll('.lecture-item').forEach(item => {
            item.classList.remove('drag-over');
          });
          updateOrderNumbers();
        }
      });

      lecturesList.addEventListener('dragover', (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(lecturesList, e.clientY);
        const dragging = document.querySelector('.dragging');

        document.querySelectorAll('.lecture-item').forEach(item => {
          item.classList.remove('drag-over');
        });

        if (afterElement) {
          afterElement.classList.add('drag-over');
          lecturesList.insertBefore(dragging, afterElement);
        } else {
          lecturesList.appendChild(dragging);
        }
      });
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.lecture-item:not(.dragging)')];

      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function moveLecture(lectureId, direction) {
      const item = document.querySelector(`.lecture-item[data-id="${lectureId}"]`);
      if (!item) return;

      const parent = item.parentNode;
      if (direction === 'up' && item.previousElementSibling) {
        parent.insertBefore(item, item.previousElementSibling);
      } else if (direction === 'down' && item.nextElementSibling) {
        parent.insertBefore(item.nextElementSibling, item);
      }

      updateOrderNumbers();
    }

    function updateOrderNumbers() {
      const items = document.querySelectorAll('.lecture-item');
      items.forEach((item, index) => {
        const orderBadge = item.querySelector('.lecture-order');
        if (orderBadge) {
          orderBadge.textContent = index + 1;
        }

        // Update move button states
        const upBtn = item.querySelector('.move-btn:first-child');
        const downBtn = item.querySelector('.move-btn:last-child');
        if (upBtn) upBtn.disabled = index === 0;
        if (downBtn) downBtn.disabled = index === items.length - 1;
      });

      orderChanged = true;
      document.getElementById('saveOrderBtn').classList.add('visible');
    }

    async function saveOrder() {
      const items = document.querySelectorAll('.lecture-item');
      const lectureIds = Array.from(items).map(item => item.dataset.id);

      const saveBtn = document.getElementById('saveOrderBtn');
      saveBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
      saveBtn.disabled = true;

      try {
        const response = await fetch(`/admin/series/${seriesId}/reorder-lectures`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ lectureIds })
        });

        const result = await response.json();

        if (result.success) {
          saveBtn.textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸';
          orderChanged = false;
          setTimeout(() => {
            saveBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯';
            saveBtn.classList.remove('visible');
            saveBtn.disabled = false;
          }, 2000);
        } else {
          throw new Error(result.error || 'Unknown error');
        }
      } catch (error) {
        console.error('Save order error:', error);
        saveBtn.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸';
        saveBtn.disabled = false;
        setTimeout(() => {
          saveBtn.textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯';
        }, 2000);
      }
    }

    // Remove lecture from series (doesn't delete the lecture)
    async function removeLectureFromSeries(lectureId, title) {
      if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© "${title}..." Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù„Ø³Ù„Ø©ØŸ\n\nÙ„Ù† ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŒ ÙÙ‚Ø· Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø³Ù„Ø³Ù„Ø©.`)) {
        return;
      }

      try {
        const response = await fetch(`/admin/lectures/${lectureId}/remove-from-series`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const result = await response.json();

        if (result.success) {
          // Remove the lecture item from the list
          const lectureItem = document.querySelector(`.lecture-item[data-id="${lectureId}"]`);
          if (lectureItem) {
            lectureItem.style.transition = 'opacity 0.3s, transform 0.3s';
            lectureItem.style.opacity = '0';
            lectureItem.style.transform = 'translateX(20px)';
            setTimeout(() => {
              lectureItem.remove();
              updateOrderNumbers();
              // Update lecture count
              const countSpan = document.querySelector('.lecture-count');
              if (countSpan) {
                const currentCount = parseInt(countSpan.textContent) - 1;
                countSpan.textContent = `${currentCount} Ù…Ø­Ø§Ø¶Ø±Ø©`;
              }
            }, 300);
          }
        } else {
          alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©: ' + (result.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
        }
      } catch (error) {
        console.error('Remove lecture error:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©');
      }
    }

    // Warn before leaving if order changed
    window.addEventListener('beforeunload', (e) => {
      if (orderChanged) {
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>
</body>
</html>
