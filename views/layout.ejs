<!DOCTYPE html>
<html lang="<%= locale %>" dir="<%= isRTL ? 'rtl' : 'ltr' %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - <%= locale === 'ar' ? 'موقع الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %></title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="<%= locale === 'ar' ? 'الموقع الرسمي للشيخ حسن بن محمد الدغريري - تلميذ الشيخ أحمد النجمي والشيخ زيد المدخلي. دروس ومحاضرات في العقيدة والفقه والتفسير من جامع الورود بجدة. أكثر من 30 عاماً من الأرشفة والتعليم.' : 'Official site of Sheikh Hasan bin Mohammed Dhaghriri - student of Sheikh Ahmad al-Najmi and Sheikh Zaid al-Madkhali. Islamic lectures on Aqeedah, Fiqh, and Tafsir from Masjid al-Wurud in Jeddah.' %>">
  <meta name="keywords" content="<%= locale === 'ar' ? 'الشيخ حسن الدغريري, حسن بن محمد الدغريري, تلميذ الشيخ أحمد النجمي, جامع الورود جدة, المنهج السلفي, علماء جازان, صامطة, الدغارير, شرح كتاب التوحيد, شرح عمدة الأحكام, دروس العقيدة, محاضرات إسلامية' : 'Sheikh Hasan Dhaghriri, Islamic lectures, Salafi scholars, Jeddah, Saudi Arabia, Aqeedah, Fiqh, Tafsir' %>">
  <meta name="author" content="<%= locale === 'ar' ? 'الشيخ حسن بن محمد الدغريري' : 'Sheikh Hasan bin Mohammed Dhaghriri' %>">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://rasmihassan.com<%= typeof canonicalPath !== 'undefined' ? canonicalPath : (typeof currentPath !== 'undefined' ? currentPath : '') %>">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://rasmihassan.com<%= typeof canonicalPath !== 'undefined' ? canonicalPath : (typeof currentPath !== 'undefined' ? currentPath : '') %>">
  <meta property="og:title" content="<%= title %> - <%= locale === 'ar' ? 'موقع الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %>">
  <meta property="og:description" content="<%= locale === 'ar' ? 'الموقع الرسمي للشيخ حسن بن محمد الدغريري - دروس ومحاضرات في العقيدة والفقه من جامع الورود بجدة' : 'Official site of Sheikh Hasan Dhaghriri - Islamic lectures from Jeddah' %>">
  <meta property="og:locale" content="<%= locale === 'ar' ? 'ar_SA' : 'en_US' %>">
  <meta property="og:site_name" content="<%= locale === 'ar' ? 'موقع الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %>">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="<%= title %> - <%= locale === 'ar' ? 'موقع الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %>">
  <meta name="twitter:description" content="<%= locale === 'ar' ? 'الموقع الرسمي للشيخ حسن بن محمد الدغريري - دروس ومحاضرات إسلامية' : 'Official site of Sheikh Hasan Dhaghriri - Islamic lectures' %>">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://rasmihassan.com/#website",
        "url": "https://rasmihassan.com",
        "name": "<%= locale === 'ar' ? 'موقع الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %>",
        "description": "<%= locale === 'ar' ? 'الموقع الرسمي للشيخ حسن بن محمد الدغريري' : 'Official website of Sheikh Hasan Dhaghriri' %>",
        "inLanguage": ["ar", "en"],
        "publisher": {
          "@id": "https://rasmihassan.com/#person"
        }
      },
      {
        "@type": "Person",
        "@id": "https://rasmihassan.com/#person",
        "name": "<%= locale === 'ar' ? 'الشيخ حسن بن محمد منصور الدغريري' : 'Sheikh Hasan bin Mohammed Mansour Dhaghriri' %>",
        "alternateName": ["حسن الدغريري", "حسن بن محمد الدغريري", "الشيخ حسن الدغيري", "Hasan Dhaghriri"],
        "description": "<%= locale === 'ar' ? 'عالم وداعية سلفي، تلميذ الشيخ أحمد النجمي والشيخ زيد المدخلي، يلقي دروسه في جامع الورود بجدة' : 'Islamic scholar and preacher, student of Sheikh Ahmad al-Najmi and Sheikh Zaid al-Madkhali' %>",
        "url": "https://rasmihassan.com",
        "sameAs": [
          "https://t.me/daririhasan"
        ],
        "jobTitle": "<%= locale === 'ar' ? 'عالم وداعية' : 'Islamic Scholar' %>",
        "worksFor": {
          "@type": "Mosque",
          "name": "<%= locale === 'ar' ? 'جامع الورود' : 'Masjid Al-Wurud' %>",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": "<%= locale === 'ar' ? 'جدة' : 'Jeddah' %>",
            "addressCountry": "SA"
          }
        },
        "knowsAbout": ["العقيدة", "الفقه", "التفسير", "الحديث", "Aqeedah", "Fiqh", "Tafsir", "Hadith"]
      }
    ]
  }
  </script>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/x-icon" href="/favicon.svg">

  <!-- DNS Prefetch for external resources -->
  <link rel="dns-prefetch" href="https://objectstorage.me-jeddah-1.oraclecloud.com">

  <!-- Self-hosted Noto Naskh Arabic (variable font, 400-700 weight range) -->
  <link rel="preload" href="/fonts/NotoNaskhArabic-variable.woff2" as="font" type="font/woff2" crossorigin>
  <style>
    @font-face{font-family:'Noto Naskh Arabic';src:url('/fonts/NotoNaskhArabic-variable.woff2') format('woff2');font-weight:400 700;font-style:normal;font-display:swap}
  </style>

  <!-- CSS: audioPlayer loaded async (not needed for initial paint) -->
  <link rel="stylesheet" href="/css/audioPlayer.css" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/css/audioPlayer.css"></noscript>

  <!-- Non-critical CSS loaded asynchronously -->
  <link rel="preload" href="/css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/css/main.css"></noscript>

  <!-- Critical inline CSS for above-the-fold content (minimized for performance) -->
  <style>
    :root{--primary-dark:#2C1810;--primary-brown:#5C4033;--accent-gold:#C19A6B;--accent-amber:#D4A574;--cream:#F5EBE0;--paper:#FAF7F2;--sage:#8B9D83;--text-primary:#2C1810;--text-secondary:#5C4033;--text-muted:#8B7355;--border-light:#E8DCC8;--shadow-warm:rgba(92,64,51,0.15);--font-arabic-display:'Noto Naskh Arabic',Tahoma,sans-serif;--font-arabic-body:'Noto Naskh Arabic',Tahoma,sans-serif;--space-xs:4px;--space-sm:8px;--space-md:16px;--space-lg:24px;--space-xl:32px;--space-2xl:48px;--space-3xl:64px}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:var(--font-arabic-body);background:var(--paper);color:var(--text-primary);line-height:1.9;direction:rtl;padding-bottom:140px}
    h1,h2,h3,h4,h5,h6{font-family:var(--font-arabic-display);font-weight:700}
    .container{max-width:1280px;margin:0 auto;padding:0 24px}
    .header{background:linear-gradient(135deg,#2C1810 0%,#3D2419 100%);border-bottom:3px solid #C19A6B;position:sticky;top:0;z-index:1000;box-shadow:0 4px 12px var(--shadow-warm);height:68px;display:flex;align-items:center}
    .header-content{max-width:1200px;margin:0 auto;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;width:100%}
    .logo{display:flex;align-items:center;font-family:var(--font-arabic-display);font-size:22px;font-weight:700;color:#FAF7F2;text-decoration:none;text-shadow:2px 2px 4px rgba(0,0,0,0.3);letter-spacing:0.5px;line-height:1.3}
    .logo-text{display:block}
    .header-actions{display:flex;gap:var(--space-md);align-items:center}
    .nav-desktop{display:flex;gap:var(--space-lg);align-items:center}
    .nav-link{color:var(--cream);text-decoration:none;font-size:15px;font-weight:500;padding:8px 4px;position:relative;transition:color 0.3s ease}
    #langToggle{background:transparent;color:#FAF7F2;border:2px solid #C19A6B;padding:8px 20px;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s ease}
    main{min-height:calc(100vh - 300px);padding:0}
    .hamburger-btn{display:none;flex-direction:column;justify-content:center;align-items:center;width:44px;height:44px;background:rgba(193,154,107,0.15);border:2px solid var(--accent-gold);border-radius:8px;cursor:pointer;padding:10px;gap:5px;z-index:1002}
    .hamburger-line{display:block;width:22px;height:3px;background:var(--accent-gold);border-radius:2px;transition:all 0.3s ease}
    .mobile-nav{position:fixed;top:0;right:-100%;width:280px;height:100vh;background:linear-gradient(180deg,#2C1810 0%,#3D2419 100%);z-index:1001;transition:right 0.3s ease;padding-top:80px;box-shadow:-4px 0 20px rgba(0,0,0,0.3)}
    .mobile-nav.active{right:0}
    .mobile-nav-backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s ease}
    .mobile-nav-backdrop.active{opacity:1;visibility:visible}
    @media(max-width:768px){.header{height:auto;min-height:56px}.header-content{padding:12px 16px;gap:12px}.logo{font-size:18px}.nav-desktop{display:none}.hamburger-btn{display:flex}.header-actions{flex-shrink:0;gap:var(--space-sm)}#langToggle{padding:6px 14px;font-size:13px}}
    @media(min-width:769px){.mobile-nav,.hamburger-btn{display:none!important}}
  </style>
</head>
<body>
  <%- include('partials/header') %>

  <main>
    <%- body %>
  </main>

  <%- include('partials/footer') %>

  <%- include('partials/audioPlayer') %>

  <!-- Admin Button (shown only if user is authenticated) - styles in main.css -->
  <% if (typeof user !== 'undefined' && user) { %>
    <a href="/admin/dashboard" class="admin-fab" title="Admin Panel">⚙️</a>
  <% } %>

  <!-- Mobile Nav Backdrop -->
  <div id="mobileNavBackdrop" class="mobile-nav-backdrop"></div>

  <script src="/js/audioPlayer.min.js" defer></script>
  <script>
    // Language Toggle Functionality
    (function() {
      const langToggle = document.getElementById('langToggle');
      const langText = document.getElementById('langText');

      if (langToggle) {
        langToggle.addEventListener('click', function() {
          const currentLocale = '<%= locale %>';
          const newLocale = currentLocale === 'ar' ? 'en' : 'ar';

          // Set cookie for 1 year
          document.cookie = `locale=${newLocale}; path=/; max-age=${60 * 60 * 24 * 365}`;

          // Reload page with new locale
          const url = new URL(window.location.href);
          url.searchParams.set('lang', newLocale);
          window.location.href = url.toString();
        });
      }
    })();

    // Mobile Navigation Toggle
    (function() {
      const menuToggle = document.getElementById('menuToggle');
      const mobileNav = document.getElementById('mobileNav');
      const backdrop = document.getElementById('mobileNavBackdrop');

      if (menuToggle && mobileNav && backdrop) {
        function toggleMenu() {
          const isOpen = mobileNav.classList.contains('active');
          menuToggle.classList.toggle('active', !isOpen);
          mobileNav.classList.toggle('active', !isOpen);
          backdrop.classList.toggle('active', !isOpen);
          menuToggle.setAttribute('aria-expanded', !isOpen);
          document.body.style.overflow = !isOpen ? 'hidden' : '';
        }

        function closeMenu() {
          menuToggle.classList.remove('active');
          mobileNav.classList.remove('active');
          backdrop.classList.remove('active');
          menuToggle.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        }

        menuToggle.addEventListener('click', toggleMenu);
        backdrop.addEventListener('click', closeMenu);

        // Close menu when clicking a link
        mobileNav.querySelectorAll('.mobile-nav-link').forEach(link => {
          link.addEventListener('click', closeMenu);
        });

        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
            closeMenu();
          }
        });

        // Close menu on window resize to desktop
        window.addEventListener('resize', function() {
          if (window.innerWidth > 768 && mobileNav.classList.contains('active')) {
            closeMenu();
          }
        });
      }
    })();
  </script>
</body>
</html>
